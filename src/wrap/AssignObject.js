import { objectAssign } from "fest/core";
import { $originalKey$ } from "./Symbol";
import { $originalObjects$ } from "./Utils";
//
export class AssignObjectHandler {
    constructor() { }
    deleteProperty(target, name) { const result = Reflect.deleteProperty(target, name); return result; }
    construct(target, args, newT) { return Reflect.construct(target, args, newT); }
    apply(target, ctx, args) { return Reflect.apply(target, ctx, args); }
    has(target, prop) { return Reflect.has(target, prop); }
    set(target, name, value) { objectAssign(target, value, name); return true; }
    get(target, name, ctx) {
        if (typeof name == "symbol") {
            return target?.[name] ?? target;
        }
        return Reflect.get(target, name, ctx);
    }
}
//
export const makeObjectAssignable = (obj) => {
    // @ts-ignore
    if (obj?.[$originalKey$] || $originalObjects$.has(obj)) {
        return obj;
    }
    // @ts-ignore
    const px = new Proxy(obj, new AssignObjectHandler());
    $originalObjects$.set(px, obj);
    return px;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXNzaWduT2JqZWN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQXNzaWduT2JqZWN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDekMsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUN6QyxPQUFPLEVBQUUsaUJBQWlCLEVBQW1DLE1BQU0sU0FBUyxDQUFDO0FBRTdFLEVBQUU7QUFDRixNQUFNLE9BQU8sbUJBQW1CO0lBQzVCLGdCQUFnQixDQUFDO0lBQ2pCLGNBQWMsQ0FBQyxNQUFNLEVBQUUsSUFBYSxJQUFJLE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsT0FBTyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQzdHLFNBQVMsQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksSUFBSSxPQUFPLE9BQU8sQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDL0UsS0FBSyxDQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUUsSUFBSSxJQUFJLE9BQU8sT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNyRSxHQUFHLENBQUMsTUFBTSxFQUFFLElBQWEsSUFBSSxPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNoRSxHQUFHLENBQUMsTUFBTSxFQUFFLElBQWEsRUFBRSxLQUFLLElBQUksWUFBWSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxPQUFPLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDckYsR0FBRyxDQUFDLE1BQU0sRUFBRSxJQUFhLEVBQUUsR0FBRztRQUMxQixJQUFJLE9BQU8sSUFBSSxJQUFJLFFBQVEsRUFBRSxDQUFDO1lBQUMsT0FBTyxNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxNQUFNLENBQUM7UUFBQyxDQUFDO1FBQ2pFLE9BQU8sT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQzFDLENBQUM7Q0FDSjtBQUVELEVBQUU7QUFDRixNQUFNLENBQUMsTUFBTSxvQkFBb0IsR0FBRyxDQUFjLEdBQVUsRUFBdUIsRUFBRTtJQUNqRixhQUFhO0lBQ2IsSUFBSSxHQUFHLEVBQUUsQ0FBQyxhQUFhLENBQUMsSUFBSSxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztRQUFDLE9BQU8sR0FBRyxDQUFDO0lBQUMsQ0FBQztJQUV2RSxhQUFhO0lBQ2IsTUFBTSxFQUFFLEdBQUcsSUFBSSxLQUFLLENBQUMsR0FBRyxFQUFFLElBQUksbUJBQW1CLEVBQUUsQ0FBQyxDQUFDO0lBQ3JELGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFBQyxPQUFPLEVBQUUsQ0FBQztBQUM5QyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBvYmplY3RBc3NpZ24gfSBmcm9tIFwiZmVzdC9jb3JlXCI7XG5pbXBvcnQgeyAkb3JpZ2luYWxLZXkkIH0gZnJvbSBcIi4vU3ltYm9sXCI7XG5pbXBvcnQgeyAkb3JpZ2luYWxPYmplY3RzJCwgdHlwZSBrZXlUeXBlLCB0eXBlIG9ic2VydmVWYWxpZCB9IGZyb20gXCIuL1V0aWxzXCI7XG5cbi8vXG5leHBvcnQgY2xhc3MgQXNzaWduT2JqZWN0SGFuZGxlciB7XG4gICAgY29uc3RydWN0b3IoKSB7IH1cbiAgICBkZWxldGVQcm9wZXJ0eSh0YXJnZXQsIG5hbWU6IGtleVR5cGUpIHsgY29uc3QgcmVzdWx0ID0gUmVmbGVjdC5kZWxldGVQcm9wZXJ0eSh0YXJnZXQsIG5hbWUpOyByZXR1cm4gcmVzdWx0OyB9XG4gICAgY29uc3RydWN0KHRhcmdldCwgYXJncywgbmV3VCkgeyByZXR1cm4gUmVmbGVjdC5jb25zdHJ1Y3QodGFyZ2V0LCBhcmdzLCBuZXdUKTsgfVxuICAgIGFwcGx5KHRhcmdldCwgY3R4LCBhcmdzKSB7IHJldHVybiBSZWZsZWN0LmFwcGx5KHRhcmdldCwgY3R4LCBhcmdzKTsgfVxuICAgIGhhcyh0YXJnZXQsIHByb3A6IGtleVR5cGUpIHsgcmV0dXJuIFJlZmxlY3QuaGFzKHRhcmdldCwgcHJvcCk7IH1cbiAgICBzZXQodGFyZ2V0LCBuYW1lOiBrZXlUeXBlLCB2YWx1ZSkgeyBvYmplY3RBc3NpZ24odGFyZ2V0LCB2YWx1ZSwgbmFtZSk7IHJldHVybiB0cnVlOyB9XG4gICAgZ2V0KHRhcmdldCwgbmFtZToga2V5VHlwZSwgY3R4KSB7XG4gICAgICAgIGlmICh0eXBlb2YgbmFtZSA9PSBcInN5bWJvbFwiKSB7IHJldHVybiB0YXJnZXQ/LltuYW1lXSA/PyB0YXJnZXQ7IH1cbiAgICAgICAgcmV0dXJuIFJlZmxlY3QuZ2V0KHRhcmdldCwgbmFtZSwgY3R4KTtcbiAgICB9XG59XG5cbi8vXG5leHBvcnQgY29uc3QgbWFrZU9iamVjdEFzc2lnbmFibGUgPSA8VW5kZXIgPSBhbnk+KG9iajogVW5kZXIpOiBvYnNlcnZlVmFsaWQ8VW5kZXI+ID0+IHtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgaWYgKG9iaj8uWyRvcmlnaW5hbEtleSRdIHx8ICRvcmlnaW5hbE9iamVjdHMkLmhhcyhvYmopKSB7IHJldHVybiBvYmo7IH1cblxuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBjb25zdCBweCA9IG5ldyBQcm94eShvYmosIG5ldyBBc3NpZ25PYmplY3RIYW5kbGVyKCkpO1xuICAgICRvcmlnaW5hbE9iamVjdHMkLnNldChweCwgb2JqKTsgcmV0dXJuIHB4O1xufVxuIl19